<!DOCTYPE html>
<html>
<head>
<title>Lightupon User Stats</title>
<meta charset="UTF-8">
</head>
<body>
<style>

body {
	font-family: 'Helvetica', 'Arial', sans-serif;
  color: #444444;
  font-size: 12pt;
}
th, td {
    border-bottom: 1px solid #ddd;
}

th, td {
    padding: 15px;
    text-align: left;
}

</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<!-- <script src="https://cdn.datatables.net/1.10.14/js/jquery.dataTables.min.js"></script> -->

<script>
(function(){

  // $('.stats').DataTable( {
  //       "ajax": '/lightupon/stats/json'
  //   } );

	init();

  function init() {
		var token = localStorage["lightuponToken"];
		console.log("token")
		console.log(token)
		// TODO: actually make a request to lightupon server using token, and only try to proceed if successful
		if (token) {
	  		getBookmarks(token)
		} else {
			// You fucked up! Go to login!
			window.alert("YA DONE GOOFED! You need to log in. Click ok and you'll be taken straight there.")
			window.location = "/lightupon/login";
		}
  }


  function getBookmarks(token) {
  	$.ajax({
      method: "GET",
      beforeSend: function (request) {
        request.setRequestHeader("Authorization", "Bearer " + token);
      },
      url:"/lightupon/stats/json"
    }).done(function(response){
      console.log(response)
    	displayStats(JSON.parse(response))
    });
  }



  function displayStats(stats) {
    if(!stats) {alert("No stats returned from the server!"); return;}

    var table = $('<table></table>');

    var tableHeader = $('<thead><tr><th>User</th><th>Scene Unlocks</th><th>Scene GETs</th></tr></thead>');
    table.append(tableHeader)
    
    var tableBody = $('<tbody></tbody>');


  	// For each bookmark we get back, build a tr and stick it on the table
  	for (var i = 0, len = stats.length; i < len; i++) {
  		var statsRow = stats[i];

  		var linkTD = $('<td>' + statsRow["Name"] + '</td>');
      var unlocksTD = $('<td>' + statsRow["NumExposedScenes"] + '</td>');
      var getsTD = $('<td>' + statsRow["NumSceneGets"] + '</td>');
  		
  		// Create the row and append the td's we made
  		var tr = $('<tr></tr>')
  		tr.append(linkTD)
      tr.append(unlocksTD)
      tr.append(getsTD)

  		// Now stick the row on the table
  		tableBody.append(tr)
      
		}
    table.append(tableBody)

  	$(".stats").html(table);
    // table.DataTable();
  }

})();

</script>
<div class="stats">
	things are broke
</div>
</body>
</html>
